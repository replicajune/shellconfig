name: Shellcheck

on: [push]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
      - name: clone
        uses: actions/checkout@v1
      - name: install
        run: |
          sudo apt-get -qqq update &> /dev/null
          sudo apt-get -qqq -y install --no-install-recommends shellcheck
      - name: lint
        run: |
          while IFS= read -r -d '' SHFILE; do
            if ! head -1 "${SHFILE}" | grep -Fq '#!/usr/bin/env zsh'; then
              shellcheck --external-sources --format=gcc --color=always \
                --exclude=SC1090 "${SHFILE}" || ERROR=1; true
            fi
          done  < <(find . -name "*.sh" -type f -print0)
          [ -n "${ERROR}" ] && exit 1
